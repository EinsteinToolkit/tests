<?xml version="1.0" encoding="utf-8" ?> 
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">  
<!--http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd-->  
<html xmlns="http://www.w3.org/1999/xhtml"  
> 
<head> <title>OpenCL</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> 
<meta name="generator" content="TeX4ht (https://tug.org/tex4ht/)" /> 
<meta name="originator" content="TeX4ht (https://tug.org/tex4ht/)" /> 
<!-- mathjax,charset=utf-8,html,xhtml --> 
<meta name="src" content="documentation.tex" /> 
<link rel="stylesheet" type="text/css" href="documentation.css" /> 
<script>window.MathJax = { tex: { tags: "ams", }, }; </script> 
 <script type="text/javascript" async="async" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js"></script>  
</head><body 
>
<div class="maketitle">
                                                                                       
                                                                                       
                                                                                       
                                                                                       

<h2 class="titleHead">OpenCL</h2>
 <div class="author" ><span 
class="cmr-12">Erik Schnetter </span><span 
class="cmmi-12">&#x003C;</span><span 
class="cmr-12">eschnetter@perimeterinstitute.ca</span><span 
class="cmmi-12">&#x003E;</span><span 
class="cmr-12">, Federico Cipolletta</span></div>
<br />
<div class="date" ><span 
class="cmr-12">2020-07-01</span></div>
</div>
<div 
class="abstract" 
>
<h3 class="abstracttitle">
<span 
class="cmbx-9">Abstract</span>
</h3>
     <!--l. 103--><p class="noindent" ><span 
class="cmti-9">OpenCL </span><span 
class="cmr-9">is a programming standard for heterogeneous systems, i.e.</span><span 
class="cmr-9"> for programming CPUs, GPUs,</span>
     <span 
class="cmr-9">and other types of accelerators. OpenCL is implemented as a library, and OpenCL codes are compiled</span>
     <span 
class="cmr-9">at run time by passing OpenCL routines, as strings, to the OpenCL library. This is different e.g.</span><span 
class="cmr-9"> from</span>
     <span 
class="cmtt-9">CUDA</span><span 
class="cmr-9">, which is implemented as a language such as C or C++.</span>
     </p><!--l. 110--><p class="indent" >   <span 
class="cmr-9">This thorn </span><span 
class="cmtt-9">OpenCL </span><span 
class="cmr-9">provides the configuration bits that ensure that Cactus applications can use</span>
     <span 
class="cmr-9">OpenCL libraries.</span>
</p>
</div>
<h3 class="sectionHead"><span class="titlemark">1   </span> <a 
 id="x1-10001"></a>Introduction</h3>
<!--l. 118--><p class="noindent" >OpenCL describes itself as:
     </p><blockquote class="quote">
                                                                                       
                                                                                       
     <!--l. 120--><p class="noindent" >OpenCL is the first open, royalty-free standard for cross-platform, parallel programming of
     modern processors found in personal computers, servers and handheld/embedded devices.
     OpenCL (Open Computing Language) greatly improves speed and responsiveness for a wide
     spectrum of applications in numerous market categories from gaming and entertainment to
     scientific and medical software.</p></blockquote>
<!--l. 127--><p class="noindent" >More information is available at <a 
href="http://www.khronos.org/opencl/" class="url" ><span 
class="cmtt-10">http://www.khronos.org/opencl/</span></a>.
</p><!--l. 131--><p class="noindent" >
</p>
<h3 class="sectionHead"><span class="titlemark">2   </span> <a 
 id="x1-20002"></a>Availability</h3>
<!--l. 133--><p class="noindent" >There seem to be four OpenCL implementations available at this time. Unfortunately, they each have their
drawbacks:
</p><!--l. 136--><p class="noindent" >
     </p><dl class="description"><dt class="description">
<span 
class="cmbx-10">AMD</span> </dt><dd 
class="description">
     <!--l. 137--><p class="noindent" >Available    at    <a 
href="http://developer.amd.com/zones/openclzone/pages/default.aspx" class="url" ><span 
class="cmtt-10">http://developer.amd.com/zones/openclzone/pages/default.aspx</span></a>.    This
     supports both CPUs and ATI GPUs. Unfortunately, the OpenCL compiler seems to produce code
     with a low quality.
     </p></dd><dt class="description">
<span 
class="cmbx-10">Apple</span> </dt><dd 
class="description">
     <!--l. 141--><p class="noindent" >Included with the operating system, available by default. This supports both CPU and GPU. The
     compiler is based on LLVM. Unfortunately, there seem to be serious bugs – for example, I can’t get
     the \(cos\) function to provide correct results.
     </p></dd><dt class="description">
<span 
class="cmbx-10">Intel</span> </dt><dd 
class="description">
     <!--l. 145--><p class="noindent" >Available  at  <a 
href="http://software.intel.com/en-us/articles/opencl-sdk/" class="url" ><span 
class="cmtt-10">http://software.intel.com/en-us/articles/opencl-sdk/</span></a>.  This  supports  only
     (Intel?) CPUs. The compiler is based on LLVM, and the implementation is also based on Intel’s
     TBB (Threading Building Blocks).
     </p></dd><dt class="description">
<span 
class="cmbx-10">Nvidia</span> </dt><dd 
class="description">
     <!--l. 150--><p class="noindent" >Available at <a 
href="http://developer.nvidia.com/opencl" class="url" ><span 
class="cmtt-10">http://developer.nvidia.com/opencl</span></a>, included in their CUDA distribution. This
     supports only GPUs.
     </p></dd><dt class="description">
<span 
class="cmbx-10">pocl</span> </dt><dd 
class="description">
     <!--l. 152--><p class="noindent" >Open source, available at <a 
href="https://launchpad.net/pocl" class="url" ><span 
class="cmtt-10">https://launchpad.net/pocl</span></a>. This OpenCL implementation has not
     yet been released (current version is 0.6), and is based on LLVM.</p></dd></dl>
<!--l. 157--><p class="noindent" >In addition, Wikipedia <a 
href="http://en.wikipedia.org/wiki/OpenCL" class="url" ><span 
class="cmtt-10">http://en.wikipedia.org/wiki/OpenCL</span></a> lists two IBM implementations for their Power
processor and for Intel compatible CPUs, respectively. The latter may be identical with or similar to AMD’s
implementation.
                                                                                       
                                                                                       
</p><!--l. 162--><p class="noindent" >Since OpenCL can run on CPUs, good OpenCL implementation are available at no cost for virtually all
platforms.
</p><!--l. 165--><p class="noindent" >It is possible to install several OpenCL implementations (<span 
class="cmti-10">platforms</span>) at the same time, to build against any one
of them, and then to choose at run time which devices from which platforms to use. For example, it is possible to
build an application using the Intel implementation, and then at run time use the Nvidia platform to access a
GPU (assuming that both Intel and Nvidia implementations are installed). On Unix, this is implemented via a
system-wide configuration directory <span 
class="cmtt-10">/etc/OpenCL/vendors </span>that lists all OpenCL platforms that will be available
at run time.
</p><!--l. 177--><p class="noindent" >
</p>
<h3 class="sectionHead"><span class="titlemark">3   </span> <a 
 id="x1-30003"></a>OpenCL Programming</h3>
<!--l. 179--><p class="noindent" >OpenCL is very similar to C. However, it differs from C in several key aspects: </p>
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 182--><p class="noindent" >much smaller run-time library, consisting mostly of mathematical functions (such as sqrt) and printf;
     </p></li>
     <li class="itemize">
     <!--l. 184--><p class="noindent" >built-in support for fine-grained and coarse-grainded multi-threading;
     </p></li>
     <li class="itemize">
     <!--l. 186--><p class="noindent" >built-in support for vectorisation.</p></li></ul>
<!--l. 188--><p class="noindent" >Given this, it is not possible to write a whole application in OpenCL. Instead, only the expensive parts (so-called
<span 
class="cmti-10">compute kernels</span>) are written in OpenCL, and are launched e.g. from C or C++.
</p><!--l. 193--><p class="noindent" >In addition, the hardware architecture of GPUs and other accelerators differs from CPUs in one key aspect:
</p>
     <ul class="itemize1">
     <li class="itemize">
     <!--l. 196--><p class="noindent" >memory is separate from the host (regular CPU) memory.</p></li></ul>
<!--l. 198--><p class="noindent" >That means that one has to explicitly copy data between the host memory and the device memory before and/or
after calling compute kernels.
</p><!--l. 204--><p class="noindent" >
</p>
                                                                                       
                                                                                       
<h3 class="sectionHead"><span class="titlemark">4   </span> <a 
 id="x1-40004"></a>OpenCL Programming in Cactus</h3>
<!--l. 206--><p class="noindent" >Cactus supports OpenCL programming at several levels. At the lowest level, one can use this thorn <span 
class="cmtt-10">OpenCL</span>
directly. While this works fine, it is somewhat tedious because one has to write a certain amount of boilerplate
code to detect and initialise the device, to copy data between host and device, and to build and run compute
kernels.
</p><!--l. 213--><p class="noindent" >Since OpenCL is implemented as a library, the flesh knows only little about OpenCL. For example, there are no
configuration options to spedify an OpenCL compiler, since code is compiled at run time via a library call to
which the source code is passed as string. There is, however, one way in which the flesh supports OpenCL:
Files with a <span 
class="cmtt-10">.cl </span>suffix are converted into a string and placed into the executable. These strings
have the type <span 
class="cmtt-10">char</span><span 
class="cmtt-10"> const</span><span 
class="cmtt-10"> * </span>in C, and can be accessed at run time under a (globally visible) name
<span 
class="cmtt-10">OpenCL</span><span 
class="cmtt-10">_source</span><span 
class="cmtt-10">_THORN</span><span 
class="cmtt-10">_FILE</span>, where <span 
class="cmtt-10">THORN </span>and <span 
class="cmtt-10">FILE </span>and are the thorn name and file name, respectively. (This is
also explained in the users’ guide.)
</p><!--l. 227--><p class="noindent" >
</p>
<h3 class="sectionHead"><span class="titlemark">5   </span> <a 
 id="x1-50005"></a>High-Level OpenCL Programming in Cactus</h3>
<!--l. 229--><p class="noindent" >Cactus also offers a higher-level way of OpenCL programming, implemented in the thorns <span 
class="cmtt-10">OpenCLRunTime </span>and
<span 
class="cmtt-10">Accelerator</span>.
</p><!--l. 233--><p class="noindent" >Thorn <span 
class="cmtt-10">OpenCLRunTime </span>provides a convenient function for executing OpenCL code. This function expects, as
input, a string containing the OpenCL kernel code, and then calls this code. Lower-level tasks such as identifying
available compute devices, initialising them, compiling the kernel (once, and then remembering it), and handling
arguments and parameters are taken care of automatically. Details are described in this thorn’s
documentation.
</p><!--l. 241--><p class="noindent" >Thorn <span 
class="cmtt-10">Accelerator </span>simplifies memory management for GPUs and other types of devices. One declares in the
thorn’s schedule which routines read and write what variables, and <span 
class="cmtt-10">Accelerator </span>then keeps track which
variables need to be copied at what time. It keeps track where (host and/or device) a variable has valid values,
and copies data only when necessary, taking time level cycling, synchronisation, and I/O into account. Details
are described in that thorn’s documentation.
</p><!--l. 250--><p class="noindent" >
</p>
<h3 class="sectionHead"><span class="titlemark">6   </span> <a 
 id="x1-60006"></a>Using This Thorn</h3>
<!--l. 252--><p class="noindent" >Refer to the Cactus UserGuide, Sec. B2.2, in order to know how this thorn can be used in a compiled
configuration and how to possibly linking another specific version, already installed steparately.
</p><!--l. 254--><p class="noindent" >
                                                                                       
                                                                                       
</p>
<h4 class="likesubsectionHead"><a 
 id="x1-7000"></a>Note on possible ExternalLibraries’ location stripping</h4>
<a 
 id="x1-7000doc"></a>
<!--l. 257--><p class="noindent" >Each thorn contained in <span 
class="cmtt-10">Cactus/arrangements/ExternalLibraries </span>will automatically adopt the library
version contained in the <span 
class="cmtt-10">Cactus/arrangements/&#x003C;library&#x003E;/dist </span>folder. In particular, the tarball in
<span 
class="cmtt-10">Cactus/arrangements/&#x003C;library&#x003E;/dist </span>is only used if either <span 
class="cmtt-10">THORN</span><span 
class="cmtt-10">_DIR </span>is set to <span 
class="cmtt-10">BUILD </span>or is left empty and no
precompiled copy of the library is found. If another location is specified via the <span 
class="cmtt-10">THORN</span><span 
class="cmtt-10">_DIR </span>variable in the
<span 
class="cmtt-10">&#x003C;machine&#x003E;.cfg </span>file at compilation, then the <span 
class="cmtt-10">Cactus/lib/sbin/strip-incdirs.sh </span>script will automatically
strip away (for safety reasons) the locations:
                  </p><dl class="list1"><dt class="list">
<span 
class="cmtt-10">/include</span>          </dt><dd 
class="list">
                  <!--l. 259--><p class="noindent" >
                  </p></dd><dt class="list">
<span 
class="cmtt-10">/usr/include</span>      </dt><dd 
class="list">
                  <!--l. 260--><p class="noindent" >
                  </p></dd><dt class="list">
<span 
class="cmtt-10">/usr/local/include</span><br 
class="newline" />                  </dt><dd 
class="list">
                  <!--l. 261--><p class="noindent" ></p></dd></dl>
<!--l. 263--><p class="noindent" >from <span 
class="cmtt-10">THORN</span><span 
class="cmtt-10">_INC</span><span 
class="cmtt-10">_DIRS </span>which default to <span 
class="cmtt-10">THORN</span><span 
class="cmtt-10">_DIR/include</span>. Therefore, if there is any need for using one
already installed version of one external library, the aforementioned location should be avoided (e.g. indicating
<span 
class="cmtt-10">/home </span>as the <span 
class="cmtt-10">THORN</span><span 
class="cmtt-10">_DIR </span>will work with no problems if the required library is installed there) or should be
carefully checked, in order to avoid unwanted stripping. The same stripping happens to <span 
class="cmtt-10">THORN</span><span 
class="cmtt-10">_LIB</span><span 
class="cmtt-10">_DIRS </span>in
<span 
class="cmtt-10">lib/sbin/strip-libdirs.sh </span>with a larger list of directories:
                  </p><dl class="list1"><dt class="list">
<span 
class="cmtt-10">/lib</span>              </dt><dd 
class="list">
                  <!--l. 265--><p class="noindent" >
                  </p></dd><dt class="list">
<span 
class="cmtt-10">/usr/lib</span>          </dt><dd 
class="list">
                  <!--l. 266--><p class="noindent" >
                  </p></dd><dt class="list">
<span 
class="cmtt-10">/usr/local/lib</span>    </dt><dd 
class="list">
                  <!--l. 267--><p class="noindent" >
                  </p></dd><dt class="list">
<span 
class="cmtt-10">/lib64</span>            </dt><dd 
class="list">
                  <!--l. 268--><p class="noindent" >
                  </p></dd><dt class="list">
<span 
class="cmtt-10">/usr/lib64</span>        </dt><dd 
class="list">
                  <!--l. 269--><p class="noindent" >
                                                                                       
                                                                                       
                  </p></dd><dt class="list">
<span 
class="cmtt-10">/usr/local/lib64</span>  </dt><dd 
class="list">
                  <!--l. 270--><p class="noindent" ></p></dd></dl>
<!--l. 283--><p class="noindent" >
</p>
<h3 class="sectionHead"><span class="titlemark">7   </span> <a 
 id="x1-80007"></a>Parameters</h3>
<!--l. 289--><p class="noindent" >
</p>
<h3 class="sectionHead"><span class="titlemark">8   </span> <a 
 id="x1-90008"></a>Interfaces</h3>
<!--l. 294--><p class="noindent" >
</p>
<h4 class="likesubsectionHead"><a 
 id="x1-10000"></a>General</h4>
<!--l. 296--><p class="noindent" ><span 
class="cmbx-10">Implements</span>:
</p><!--l. 298--><p class="noindent" >opencl
</p><!--l. 303--><p class="noindent" >
</p>
<h3 class="sectionHead"><span class="titlemark">9   </span> <a 
 id="x1-110009"></a>Schedule</h3>
<!--l. 309--><p class="noindent" >This section lists all the variables which are assigned storage by thorn ExternalLibraries/OpenCL. Storage can
either last for the duration of the run (<span 
class="cmbx-10">Always </span>means that if this thorn is activated storage will
be assigned, <span 
class="cmbx-10">Conditional </span>means that if this thorn is activated storage will be assigned for the
duration of the run if some condition is met), or can be turned on for the duration of a schedule
function.
</p><!--l. 312--><p class="noindent" >
</p>
<h4 class="likesubsectionHead"><a 
 id="x1-12000"></a>Storage</h4>
<!--l. 312--><p class="noindent" >NONE
                                                                                       
                                                                                       
</p>
<h4 class="likesubsectionHead"><a 
 id="x1-13000"></a>Scheduled Functions</h4>
<!--l. 316--><p class="noindent" ><span 
class="cmbx-10">CCTK</span><span 
class="cmbx-10">_WRAGH</span>
</p><!--l. 318--><p class="noindent" >      opencl_printinfo
</p><!--l. 320--><p class="noindent" >     <span 
class="cmti-10">print opencl system information</span>
</p><!--l. 323--><p class="noindent" > 
</p><!--l. 325--><p class="noindent" ></p> <table id="TBL-2" class="tabular" 
 
><colgroup id="TBL-2-1g"><col 
id="TBL-2-1" /><col 
id="TBL-2-2" /><col 
id="TBL-2-3" /></colgroup><tr  
 style="vertical-align:baseline;" id="TBL-2-1-"><td  style="white-space:nowrap; text-align:center;" id="TBL-2-1-1"  
class="td11">    </td><td  style="white-space:nowrap; text-align:left;" id="TBL-2-1-2"  
class="td11"> Language:  </td><td  style="white-space:nowrap; text-align:left;" id="TBL-2-1-3"  
class="td11"> c           </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-2-2-"><td  style="white-space:nowrap; text-align:center;" id="TBL-2-2-1"  
class="td11">    </td><td  style="white-space:nowrap; text-align:left;" id="TBL-2-2-2"  
class="td11"> Type:        </td><td  style="white-space:nowrap; text-align:left;" id="TBL-2-2-3"  
class="td11"> function  </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-2-3-"><td  style="white-space:nowrap; text-align:center;" id="TBL-2-3-1"  
class="td11">    </td></tr></table>
 
</body></html> 

                                                                                       


