<?xml version="1.0" encoding="utf-8" ?> 
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">  
<!--http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd-->  
<html xmlns="http://www.w3.org/1999/xhtml"  
> 
<head> <title>LocalReduce</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> 
<meta name="generator" content="TeX4ht (https://tug.org/tex4ht/)" /> 
<meta name="originator" content="TeX4ht (https://tug.org/tex4ht/)" /> 
<!-- mathjax,charset=utf-8,html,xhtml --> 
<meta name="src" content="documentation.tex" /> 
<link rel="stylesheet" type="text/css" href="documentation.css" /> 
<script>window.MathJax = { tex: { tags: "ams", }, }; </script> 
 <script type="text/javascript" async="async" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js"></script>  
</head><body 
>
<div class="maketitle">
                                                                                       
                                                                                       
                                                                                       
                                                                                       

<h2 class="titleHead">LocalReduce</h2>
 <div class="author" ><span 
class="cmr-12">Yaakoub Y El Khamra </span><span 
class="cmmi-12">&#x003C;</span><span 
class="cmr-12">yye00@cct.lsu.edu</span><span 
class="cmmi-12">&#x003E;</span></div>
<br />
<div class="date" >\( \)<span 
class="cmr-12">Date</span>\( \)</div>
</div>
<div 
class="abstract" 
>
<h3 class="abstracttitle">
<span 
class="cmbx-9">Abstract</span>
</h3>
     <!--l. 101--><p class="noindent" ><span 
class="cmr-9">This thorn implement processor-local reduction operations.</span>
</p>
</div>
<h3 class="sectionHead"><span class="titlemark">1   </span> <a 
 id="x1-10001"></a>Introduction</h3>
<!--l. 108--><p class="noindent" >A reduction operation can be defined as an operation on arrays (tuples) of variables resulting in
a single number. Typical reduction operations are sum, minimum/maximum value, and boolean
operations. A typical application is, for example, finding the minimum value in an \(n\)-dimensional
array.
</p><!--l. 114--><p class="noindent" >This thorn provides processor-local reduction operations only. Global reduction operations can make use of these
local reduction operations by providing the necessary inter-processor communication.
                                                                                       
                                                                                       
</p><!--l. 118--><p class="noindent" >
</p>
<h3 class="sectionHead"><span class="titlemark">2   </span> <a 
 id="x1-20002"></a>Numerical Implementation</h3>
<!--l. 119--><p class="noindent" >The new local reduce thorn has several new features including index strides and offsets for array indexing and
full complex number support. Pending request, weight support can be enabled (there are some issues that a
mask is essentially a weight with 1 or 0 value).
</p><!--l. 124--><p class="noindent" >Modifying or extending this thorn is quite a simple matter. The heart of all the reduction operations is the large
iterator macro in local_reductions.h. This iterator supports n-dimensional arrays with offsets and strides. The
iterator is used in all local reduction operators in this thorn. To add a reduction operator, or change an existing
one, all that needs to be done is to change the actual reduction operation definition which is called from within
the iterator to perform the reduction.
</p><!--l. 133--><p class="noindent" >To use a custom local reduction operator from the new global reduction implementation, some values must be
returned to the global reduction implementation, such as the type of MPI reduction operation that needs to be
performed (MPI_SUM, MPI_MIN, MPI_MAX) and if the final result should include a division by the total
number of points used in the reduction. These are set in the parameter table with keys: mpi_operation and
perform_division.
</p><!--l. 141--><p class="noindent" >
</p>
<h3 class="sectionHead"><span class="titlemark">3   </span> <a 
 id="x1-30003"></a>Using This Thorn</h3>
<!--l. 142--><p class="noindent" >Please refer to the TestLocalReduce thorn in the CactusTest arrangement.
</p><!--l. 145--><p class="noindent" >
</p>
<h3 class="sectionHead"><span class="titlemark">4   </span> <a 
 id="x1-40004"></a>Reduction Operations</h3>
<!--l. 147--><p class="noindent" >
</p>
<h4 class="subsectionHead"><span class="titlemark">4.1   </span> <a 
 id="x1-50004.1"></a>Basic Reduction Operations</h4>
<!--l. 148--><p class="noindent" >The following reduction operations are imlemented. \(a_i\) are the values that are reduced, \(i \in [1 \ldots n]\).
     </p><dl class="description"><dt class="description">
<span 
class="cmbx-10">count:</span> </dt><dd 
class="description">
     <!--l. 151--><p class="noindent" >The number of values
                                                                                       
                                                                                       
                                              \[ \mathrm {count} := n \]
     </p></dd><dt class="description">
<span 
class="cmbx-10">sum:</span> </dt><dd 
class="description">
     <!--l. 153--><p class="noindent" >The sum of the values
                                              \[ \mathrm {sum} := \sum _i a_i \]
     </p></dd><dt class="description">
<span 
class="cmbx-10">product:</span> </dt><dd 
class="description">
     <!--l. 155--><p class="noindent" >The product of the values
                                              \[ \mathrm {product} := \prod _i a_i \]
     </p></dd><dt class="description">
<span 
class="cmbx-10">sum2:</span> </dt><dd 
class="description">
     <!--l. 157--><p class="noindent" >The sum of the squares of the values
                                                                                       
                                                                                       
                                              \[ \mathrm {sum2} := \sum _i a_i^2 \]
     </p></dd><dt class="description">
<span 
class="cmbx-10">sumabs:</span> </dt><dd 
class="description">
     <!--l. 159--><p class="noindent" >The sum of the absolute values
                                              \[ \mathrm {sum2} := \sum _i |a_i| \]
     </p></dd><dt class="description">
<span 
class="cmbx-10">sumabs2:</span> </dt><dd 
class="description">
     <!--l. 161--><p class="noindent" >The sum of the squares of the absolute values
                                              \[ \mathrm {sumabs2} := \sum _i |a_i|^2 \]
     </p></dd><dt class="description">
<span 
class="cmbx-10">min:</span> </dt><dd 
class="description">
     <!--l. 163--><p class="noindent" >The minimum of the values
                                              \[ \mathrm {min} := \min _i a_i \]
                                                                                       
                                                                                       
     </p></dd><dt class="description">
<span 
class="cmbx-10">max:</span> </dt><dd 
class="description">
     <!--l. 165--><p class="noindent" >The maximum of the values
                                              \[ \mathrm {max} := \max _i a_i \]
     </p></dd><dt class="description">
<span 
class="cmbx-10">maxabs:</span> </dt><dd 
class="description">
     <!--l. 167--><p class="noindent" >The maximum of the absolute values
                                              \[ \mathrm {maxabs} := \max _i |a_i| \]
     </p></dd></dl>
<!--l. 170--><p class="noindent" >Note that the above definitions are for both real and complex values. For \(n=0\), the result of the reduction operation
is \(0\), except for \(\mathrm {product}\), which is \(1\), \(\mathrm {min}\), which is \(+\infty \), and \(\mathrm {max}\), which is \(-\infty \). We define the minimum of complex values
by
                                           \[ \min \left ( a+ib, x+iy \right ) := \min \left ( a,x \right ) + i \min \left (b,y \right ) \]
 and define the maximum equivalently.
                                                                                       
                                                                                       
</p><!--l. 181--><p class="noindent" >
</p>
<h4 class="subsectionHead"><span class="titlemark">4.2   </span> <a 
 id="x1-60004.2"></a>High-level Reduction Operations</h4>
<!--l. 182--><p class="noindent" >The following high-level reduction operations are also implemented. They can be defined in terms of the basic
reduction operations above.
     </p><dl class="description"><dt class="description">
<span 
class="cmbx-10">average:</span> </dt><dd 
class="description">
     <!--l. 185--><p class="noindent" >The algebraic mean of the values
                                              \[ \mathrm {average} := \mathrm {sum} / \mathrm {count} \]
     </p></dd><dt class="description">
<span 
class="cmbx-10">norm1:</span> </dt><dd 
class="description">
     <!--l. 187--><p class="noindent" >The \(L_1\) norm, i.e., the sum of the absolute values
                                              \[ \mathrm {norm1} := \mathrm {sumabs} / \mathrm {count} \]
     </p></dd><dt class="description">
<span 
class="cmbx-10">norm2:</span> </dt><dd 
class="description">
     <!--l. 189--><p class="noindent" >The \(L_2\) norm, i.e., the Pythagorean norm
                                              \[ \mathrm {norm2} := \sqrt {\mathrm {sumabs2} / \mathrm {count}} \]
                                                                                       
                                                                                       
     </p></dd><dt class="description">
<span 
class="cmbx-10">norm</span><span 
class="cmbx-10">_inf:</span> </dt><dd 
class="description">
     <!--l. 191--><p class="noindent" >The \(L_\infty \) norm
                                              \[ \mathrm {norm\_inf} := \mathrm {maxabs} \]
     </p></dd></dl>
<!--l. 195--><p class="noindent" >
</p>
<h4 class="subsectionHead"><span class="titlemark">4.3   </span> <a 
 id="x1-70004.3"></a>Weighted Reduction Operations</h4>
<!--l. 196--><p class="noindent" >It is often convenient to assign a weight \(w_i\) to each value \(a_i\). In this case, the basic reduction operations are redefined
as follows.
     </p><dl class="description"><dt class="description">
<span 
class="cmbx-10">count:</span> </dt><dd 
class="description">
     <!--l. 199--><p class="noindent" >The number of values
                                              \[ \mathrm {count} := \sum _i w_i \]
     </p></dd><dt class="description">
<span 
class="cmbx-10">sum:</span> </dt><dd 
class="description">
     <!--l. 201--><p class="noindent" >The sum of the values
                                                                                       
                                                                                       
                                              \[ \mathrm {sum} := \sum _i w_i a_i \]
     </p></dd><dt class="description">
<span 
class="cmbx-10">product:</span> </dt><dd 
class="description">
     <!--l. 203--><p class="noindent" >The product of the values
                                              \[ \mathrm {product} := \exp \sum _i w_i \log a_i \]
     </p></dd><dt class="description">
<span 
class="cmbx-10">sum2:</span> </dt><dd 
class="description">
     <!--l. 205--><p class="noindent" >The sum of the squares of the values
                                              \[ \mathrm {sum2} := \sum _i w_i a_i^2 \]
     </p></dd><dt class="description">
<span 
class="cmbx-10">sumabs:</span> </dt><dd 
class="description">
     <!--l. 207--><p class="noindent" >The sum of the absolute values
                                                                                       
                                                                                       
                                              \[ \mathrm {sum2} := \sum _i w_i |a_i| \]
     </p></dd><dt class="description">
<span 
class="cmbx-10">sumabs2:</span> </dt><dd 
class="description">
     <!--l. 209--><p class="noindent" >The sum of the squares of the absolute values
                                              \[ \mathrm {sumabs2} := \sum _i w_i |a_i|^2 \]
     </p></dd><dt class="description">
<span 
class="cmbx-10">min:</span> </dt><dd 
class="description">
     <!--l. 211--><p class="noindent" >The minimum of the values
                                              \[ \mathrm {min} := \min _i w_i \ne 0: a_i \]
     </p></dd><dt class="description">
<span 
class="cmbx-10">max:</span> </dt><dd 
class="description">
     <!--l. 213--><p class="noindent" >The maximum of the values
                                              \[ \mathrm {max} := \max _i w_i \ne 0: a_i \]
                                                                                       
                                                                                       
     </p></dd><dt class="description">
<span 
class="cmbx-10">maxabs:</span> </dt><dd 
class="description">
     <!--l. 215--><p class="noindent" >The maximum of the absolute values
                                              \[ \mathrm {maxabs} := \max _i w_i \ne 0: |a_i| \]
     </p></dd></dl>
<!--l. 218--><p class="noindent" >The notation \(\min _i w_i \ne 0: a_i\) means: “The minimum of \(a_i\) where \(i\) runs over all values where \(w_i \ne 0\)”. The definition of the high-level
reduction operations does not change when weights are present.
</p><!--l. 228--><p class="noindent" >
</p>
<h3 class="sectionHead"><span class="titlemark">5   </span> <a 
 id="x1-80005"></a>Parameters</h3>
<!--l. 234--><p class="noindent" >
</p>
<h3 class="sectionHead"><span class="titlemark">6   </span> <a 
 id="x1-90006"></a>Interfaces</h3>
<!--l. 239--><p class="noindent" >
</p>
<h4 class="likesubsectionHead"><a 
 id="x1-10000"></a>General</h4>
<!--l. 241--><p class="noindent" ><span 
class="cmbx-10">Implements</span>:
</p><!--l. 243--><p class="noindent" >localreduce
                                                                                       
                                                                                       
</p><!--l. 248--><p class="noindent" >
</p>
<h3 class="sectionHead"><span class="titlemark">7   </span> <a 
 id="x1-110007"></a>Schedule</h3>
<!--l. 254--><p class="noindent" >This section lists all the variables which are assigned storage by thorn CactusNumerical/LocalReduce. Storage
can either last for the duration of the run (<span 
class="cmbx-10">Always </span>means that if this thorn is activated storage will
be assigned, <span 
class="cmbx-10">Conditional </span>means that if this thorn is activated storage will be assigned for the
duration of the run if some condition is met), or can be turned on for the duration of a schedule
function.
</p><!--l. 257--><p class="noindent" >
</p>
<h4 class="likesubsectionHead"><a 
 id="x1-12000"></a>Storage</h4>
<!--l. 257--><p class="noindent" >NONE
</p>
<h4 class="likesubsectionHead"><a 
 id="x1-13000"></a>Scheduled Functions</h4>
<!--l. 261--><p class="noindent" ><span 
class="cmbx-10">CCTK</span><span 
class="cmbx-10">_STARTUP</span>
</p><!--l. 263--><p class="noindent" >      localreduce_startup
</p><!--l. 265--><p class="noindent" >     <span 
class="cmti-10">startup routine</span>
</p><!--l. 268--><p class="noindent" > 
</p><!--l. 270--><p class="noindent" ></p> <table id="TBL-2" class="tabular" 
 
><colgroup id="TBL-2-1g"><col 
id="TBL-2-1" /><col 
id="TBL-2-2" /><col 
id="TBL-2-3" /></colgroup><tr  
 style="vertical-align:baseline;" id="TBL-2-1-"><td  style="white-space:nowrap; text-align:center;" id="TBL-2-1-1"  
class="td11">    </td><td  style="white-space:nowrap; text-align:left;" id="TBL-2-1-2"  
class="td11"> Language:  </td><td  style="white-space:nowrap; text-align:left;" id="TBL-2-1-3"  
class="td11"> c           </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-2-2-"><td  style="white-space:nowrap; text-align:center;" id="TBL-2-2-1"  
class="td11">    </td><td  style="white-space:nowrap; text-align:left;" id="TBL-2-2-2"  
class="td11"> Type:        </td><td  style="white-space:nowrap; text-align:left;" id="TBL-2-2-3"  
class="td11"> function  </td>
</tr><tr  
 style="vertical-align:baseline;" id="TBL-2-3-"><td  style="white-space:nowrap; text-align:center;" id="TBL-2-3-1"  
class="td11">    </td></tr></table>
 
</body></html> 

                                                                                       


