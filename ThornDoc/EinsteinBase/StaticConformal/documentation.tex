\documentclass{article}

% Use the Cactus ThornGuide style file
% (Automatically used from Cactus distribution, if you have a 
%  thorn without the Cactus Flesh download this from the Cactus
%  homepage at www.cactuscode.org)
\usepackage{../../../../../doc/latex/cactus}

\newlength{\tableWidth} \newlength{\maxVarWidth} \newlength{\paraWidth} \newlength{\descWidth} \begin{document}

\title{StaticConformal}
\author{Tom Goodale et al}
\date{$ $Date$ $}

\maketitle

% Do not delete next line
% START CACTUS THORNGUIDE

\begin{abstract}
Base thorn to provide the variables for the static conformal factor
\end{abstract}

\section{Purpose}

This thorn provides the variables defining a static conformal factor
which is used to transform the physical metric.  If this thorn is
active and the {\tt ADMBase::metric\_type} parameter is set to {\tt
static conformal}, then the {\tt ADMBase::g...} variables are the
conformal values as opposed to the physical values.

The transformation is

$$ g_{ij}^{\mbox{physical}} = \psi^4 g_{ij}^{\mbox{conformal}} $$

The extrinsic curvature is not transformed.

Memory is provided for the conformal factor {\tt psi}, its first
derivatives {\tt psix}, {\tt psiy}, {\tt psiz}, and its second
derivatives {\tt psixx}, {\tt psixy}, {\tt psixz}, {\tt psiyy}, {\tt
psiyz}, and {\tt psizz} depending on the setting of the {\tt
conformal\_storage} parameter.

Note that the first and second ``derivative'' grid functions have an
additional factor of $1 / \psi$ normalisation since this is the most
common use of the derivative.  I.e., the grid functions are

\begin{eqnarray*}
 {\tt psi} &=& \psi, \\
 {\tt psix} &=& \psi_x/\psi, \qquad \mbox{etc}\\
 {\tt psixx} &=& \psi_{ij}/\psi \qquad \mbox{etc}
\end{eqnarray*}

Thorns need to check the value of the grid scalar 
{\tt conformal\_state} to determine how many levels of these variables have
actually been calculated before using the conformal factor:

\begin{description}
\item[{\tt conformal\_state=0}] 
No conformal factor has been calculated --- thorns may
assume the conformal factor is 1 at all points.
(I.e., the metric is physical.)
\item[{\tt conformal\_state=1}] 
The conformal factor has been calulated, but no derivatives.
\item[{\tt conformal\_state=2}]
The conformal factor and its first derivatives have been calculated.
\item[{\tt conformal\_state=3}]
The conformal factor and its first and second derivatives have been calculated.
\end{description}

Note that this means that if you only want to know whether {\tt psi} contains 
the values for the conformal factor you can check for {\tt
conformal\_state > 0}.

\section{Utilities}

{\tt StaticConformal} provides aliased functions to convert between
physical and conformal 3-metric values.  It is very important to
understand that these functions apply the conversion {\em in place}.
That is, if {\tt gxx} contains the conformal metric value, when the
routine is exited it will now contain the physical metric value.
These functions {\em do not} change the value of {\tt
conformal\_state} and should be used with due care.  (These functions
are for example used by some analysis thorns who work only with the
physical metric, they apply the transformation on entry to the
analysis routine and switch it back on exit).

\begin{description}

\item[Convert from conformal to physical:]

{\tt
\begin{verbatim}

subroutine ConfToPhysInPlace (nx, ny, nz,
                              psi,
                              gxx, gxy, gxz, gyy, gyz, gzz)
   implicit none
   CCTK_INT,                         intent(in)    :: nx, ny, nz
   CCTK_REAL, dimension(nx, ny, nz), intent(in)    :: psi
   CCTK_REAL, dimension(nx, ny, nz), intent(inout) :: gxx, gxy, gxz, gyy, gyz, gzz
end subroutine ConfToPhysInPlace
\end{verbatim}
}

\item[Convert from physical to conformal:]

{\tt
\begin{verbatim}

subroutine PhysToConfInPlace (nx, ny, nz,
                              psi,
                              gxx, gxy, gxz, gyy, gyz, gzz)
   implicit none
   CCTK_INT,                         intent(in)    :: nx, ny, nz
   CCTK_REAL, dimension(nx, ny, nz), intent(in)    :: psi
   CCTK_REAL, dimension(nx, ny, nz), intent(inout) :: gxx, gxy, gxz, gyy, gyz, gzz
end subroutine ConfToPhysInPlace
\end{verbatim}
}

\end{description}

\section{Comments}

The {\tt StaticConformal} thorn itself does not calculate any conformal
factor, but does initialise the {\tt conformal\_state} variable to 0. 

% Do not delete next line
% END CACTUS THORNGUIDE



\section{Parameters} 


\parskip = 0pt

\setlength{\tableWidth}{160mm}

\setlength{\paraWidth}{\tableWidth}
\setlength{\descWidth}{\tableWidth}
\settowidth{\maxVarWidth}{conformal\_storage}

\addtolength{\paraWidth}{-\maxVarWidth}
\addtolength{\paraWidth}{-\columnsep}
\addtolength{\paraWidth}{-\columnsep}
\addtolength{\paraWidth}{-\columnsep}

\addtolength{\descWidth}{-\columnsep}
\addtolength{\descWidth}{-\columnsep}
\addtolength{\descWidth}{-\columnsep}
\noindent \begin{tabular*}{\tableWidth}{|c|l@{\extracolsep{\fill}}r|}
\hline
\multicolumn{1}{|p{\maxVarWidth}}{conformal\_storage} & {\bf Scope:} restricted & KEYWORD \\\hline
\multicolumn{3}{|p{\descWidth}|}{{\bf Description:}   {\em How much conformal storage do we have ?}} \\
\hline{\bf Range} & &  {\bf Default:} factor+derivs+2nd derivs \\\multicolumn{1}{|p{\maxVarWidth}|}{\centering factor} & \multicolumn{2}{p{\paraWidth}|}{Just the conformal factor} \\\multicolumn{1}{|p{\maxVarWidth}|}{\centering factor+derivs} & \multicolumn{2}{p{\paraWidth}|}{Conformal factor plus first derivatives} \\\multicolumn{1}{|p{\maxVarWidth}|}{see [1] below} & \multicolumn{2}{p{\paraWidth}|}{Conformal factor plus first and second derivatives} \\\hline
\end{tabular*}

\vspace{0.5cm}\noindent {\bf [1]} \noindent \begin{verbatim}factor+derivs+2nd derivs\end{verbatim}\noindent \begin{tabular*}{\tableWidth}{|c|l@{\extracolsep{\fill}}r|}
\hline
\multicolumn{1}{|p{\maxVarWidth}}{metric\_type} & {\bf Scope:} shared from ADMBASE & KEYWORD \\\hline
\multicolumn{3}{|l|}{\bf Extends ranges:}\\ 
\hline\multicolumn{1}{|p{\maxVarWidth}|}{\centering static conformal} & \multicolumn{2}{p{\paraWidth}|}{Metric is conformal with static conformal factor, extrinsic curvature is physical} \\\hline
\end{tabular*}

\vspace{0.5cm}\parskip = 10pt 

\section{Interfaces} 


\parskip = 0pt

\vspace{3mm} \subsection*{General}

\noindent {\bf Implements}: 

staticconformal
\vspace{2mm}

\noindent {\bf Inherits}: 

grid
\vspace{2mm}
\subsection*{Grid Variables}
\vspace{5mm}\subsubsection{PUBLIC GROUPS}

\vspace{5mm}

\begin{tabular*}{150mm}{|c|c@{\extracolsep{\fill}}|rl|} \hline 
~ {\bf Group Names} ~ & ~ {\bf Variable Names} ~  &{\bf Details} ~ & ~\\ 
\hline 
conformal\_state & conformal\_state & compact & 0 \\ 
 &  & dimensions & 0 \\ 
 &  & distribution & CONSTANT \\ 
 &  & group type & SCALAR \\ 
 &  & timelevels & 1 \\ 
 &  & variable type & INT \\ 
\hline 
confac &  & compact & 0 \\ 
 & psi & description & Conformal factor \\ 
 &  & dimensions & 3 \\ 
 &  & distribution & DEFAULT \\ 
 &  & group type & GF \\ 
 &  & tags & tensortypealias="Scalar" Prolongation="None" InterpNumTimelevels=1 \\ 
 &  & timelevels & 1 \\ 
 &  & variable type & REAL \\ 
\hline 
confac\_1derivs &  & compact & 0 \\ 
 & psix & description & First spatial derivatives of conformal factor divided by psi \\ 
 & psiy & dimensions & 3 \\ 
 & psiz & distribution & DEFAULT \\ 
 &  & group type & GF \\ 
 &  & tags & tensortypealias="U" Prolongation="None" InterpNumTimelevels=1 \\ 
 &  & timelevels & 1 \\ 
 &  & variable type & REAL \\ 
\hline 
confac\_2derivs &  & compact & 0 \\ 
 & psixx & description & Second spatial derivatives of conformal factor divided by psi \\ 
 & psixy & dimensions & 3 \\ 
 & psixz & distribution & DEFAULT \\ 
 & psiyy & group type & GF \\ 
 & psiyz & tags & tensortypealias="dd\_sym" Prolongation="None" InterpNumTimelevels=1 \\ 
 & psizz & timelevels & 1 \\ 
 &  & variable type & REAL \\ 
\hline 
\end{tabular*} 



\vspace{5mm}

\noindent {\bf Provides}: 



ConfToPhysInPlace to 

PhysToConfInPlace to 
\vspace{2mm}\parskip = 10pt 

\section{Schedule} 


\parskip = 0pt


\noindent This section lists all the variables which are assigned storage by thorn EinsteinBase/StaticConformal.  Storage can either last for the duration of the run ({\bf Always} means that if this thorn is activated storage will be assigned, {\bf Conditional} means that if this thorn is activated storage will be assigned for the duration of the run if some condition is met), or can be turned on for the duration of a schedule function.


\subsection*{Storage}

\hspace{5mm}

 \begin{tabular*}{160mm}{ll} 

{\bf Always:}& {\bf Conditional:} \\ 
 conformal\_state &  confac[1]\\ 
~ &  confac[1] confac\_1derivs[1]\\ 
~ &  confac[1] confac\_1derivs[1] confac\_2derivs[1]\\ 
~ & ~\\ 
\end{tabular*} 


\subsection*{Scheduled Functions}
\vspace{5mm}

\noindent {\bf CCTK\_INITIAL} 

\hspace{5mm} staticconformal\_initialisestate 

\hspace{5mm}{\it set the conformal\_state variable to 0 } 


\hspace{5mm}

 \begin{tabular*}{160mm}{cll} 
~ & Before:  & admbase\_initialdata \\ 
~ & Language:  & c \\ 
~ & Type:  & function \\ 
~ & Writes:  & staticconformal::conformal\_state(everywhere) \\ 
\end{tabular*} 



\vspace{5mm}\parskip = 10pt 
\end{document}
