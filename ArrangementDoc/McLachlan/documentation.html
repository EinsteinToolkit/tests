<?xml version="1.0" encoding="utf-8" ?> 
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">  
<!--http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd-->  
<html xmlns="http://www.w3.org/1999/xhtml"  
> 
<head> <title>McLachlan</title> 
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" /> 
<meta name="generator" content="TeX4ht (https://tug.org/tex4ht/)" /> 
<meta name="originator" content="TeX4ht (https://tug.org/tex4ht/)" /> 
<!-- mathjax,charset=utf-8,html,xhtml --> 
<meta name="src" content="documentation.tex" /> 
<link rel="stylesheet" type="text/css" href="documentation.css" /> 
<script>window.MathJax = { tex: { tags: "ams", }, }; </script> 
 <script type="text/javascript" async="async" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js"></script>  
</head><body 
>
<div class="maketitle">
                                                                                       
                                                                                       
                                                                                       
                                                                                       

<h2 class="titleHead">McLachlan</h2>
                             <div class="author" ><span 
class="cmr-12">Erik Schnetter</span>
<br /> <span 
class="cmr-12">Center for Computation &#x0026; Technology, Louisiana State University, USA</span>
<br />           <a 
href="http://www.cct.lsu.edu/~eschnett/McLachlan/" class="url" ><span 
class="cmtt-12">http://www.cct.lsu.edu/</span><span 
class="cmtt-12">~</span><span 
class="cmtt-12">eschnett/McLachlan/</span></a>
<br />                        <span 
class="cmmi-12">&#x003C;</span><span 
class="cmr-12">schnetter@cct.lsu.edu</span><span 
class="cmmi-12">&#x003E;</span></div>
<br />
<div class="date" ><span 
class="cmr-12">August 18, 2009</span></div>
</div>
<div 
class="abstract" 
>
<h3 class="abstracttitle">
<span 
class="cmbx-9">Abstract</span>
</h3>
     <!--l. 101--><p class="noindent" ><span 
class="cmr-9">McLachlan is a free Einstein solver that uses the Cactus framework and the Einstein toolkit. This</span>
     <span 
class="cmr-9">document describes the basic features of the code, and also how to obtain, build, and use the code.</span>
</p>
</div>
<h3 class="sectionHead"><span class="titlemark">1   </span> <a 
 id="x1-10001"></a>McLachlan</h3>
<!--l. 112--><p class="noindent" >McLachlan is a free Einstein solver that uses the Cactus framework and the Einstein toolkit. McLachlan
was developed by Erik Schnetter and Peter Diener with the help of Jian Tao and Ian Hinder. It
was first described in <span class="cite">[<span 
class="cmbx-10">?</span>]</span>, where (to our knowledge) the first fully fourth order accurate black hole
evolution with adaptive mesh refinement is presented. The McLachlan web pages are located at
<span class="cite">[<span 
class="cmbx-10">?</span>]</span>.
                                                                                       
                                                                                       
</p><!--l. 134--><p class="noindent" >
</p>
<h3 class="sectionHead"><span class="titlemark">2   </span> <a 
 id="x1-20002"></a>Obtaining McLachlan</h3>
<!--l. 136--><p class="noindent" >McLachlan uses the Cactus Software Framework and the Einstein Toolkit. Cactus organises applications into
<span 
class="cmti-10">thorns </span>(modules) that can be maintained independently of each other. In order to use McLachlan, it is necessary
to obtain Cactus as well as a set of supporting thorns.
</p><!--l. 141--><p class="noindent" >The subsections below describe how to obtain Cactus and other necessary thorns. McLachlan contains also a
shell script <span 
class="cmtt-10">checkout.sh</span> that attempts to automate this. However, this script is very basic and does not handle
errors well.
</p><!--l. 146--><p class="noindent" >
</p>
<h4 class="subsectionHead"><span class="titlemark">2.1   </span> <a 
 id="x1-30002.1"></a>Tools</h4>
<!--l. 148--><p class="noindent" >Cactus thorns are ususall stored in <span 
class="cmti-10">repositories </span>that are managed by version control systems such as CVS <span class="cite">[<span 
class="cmbx-10">?</span>]</span>,
SVN (subversion) <span class="cite">[<span 
class="cmbx-10">?</span>]</span>, or git <span class="cite">[<span 
class="cmbx-10">?</span>]</span>.
</p><!--l. 152--><p class="noindent" >Before getting the code, you will need to install the following software on your local system:
     </p><ol  class="enumerate1" >
<li 
  class="enumerate" id="x1-3002x1">
     <!--l. 155--><p class="noindent" >wget (or curl)
     </p></li>
<li 
  class="enumerate" id="x1-3004x2">
     <!--l. 156--><p class="noindent" >CVS
     </p></li>
<li 
  class="enumerate" id="x1-3006x3">
     <!--l. 157--><p class="noindent" >SVN
     </p></li>
<li 
  class="enumerate" id="x1-3008x4">
     <!--l. 158--><p class="noindent" >git
     </p></li>
<li 
  class="enumerate" id="x1-3010x5">
     <!--l. 159--><p class="noindent" >Perl</p></li></ol>
<!--l. 161--><p class="noindent" >These are standard packages, and they should be easily available for all Linux systems.
                                                                                       
                                                                                       
</p><!--l. 164--><p class="noindent" >
</p>
<h4 class="subsectionHead"><span class="titlemark">2.2   </span> <a 
 id="x1-40002.2"></a>Cactus</h4>
<!--l. 167--><p class="noindent" >Cactus <span class="cite">[<span 
class="cmbx-10">?</span>, <span 
class="cmbx-10">?</span>]</span> is a software framework that makes it possible to maintain parts of applications independent of
each other, and combine them into an efficient code when building the application. Cactus is described at
<a 
href="http://www.cactuscode.org/" class="url" ><span 
class="cmtt-10">http://www.cactuscode.org/</span></a>, and a new version of the of Cactus web site is currently being prepared at
<a 
href="http://preview.cactuscode.org/download/" class="url" ><span 
class="cmtt-10">http://preview.cactuscode.org/download/</span></a>.
</p><!--l. 174--><p class="noindent" >To obtain Cactus itself as well as a set of basic thorns, follow the instructions at
<a 
href="http://preview.cactuscode.org/download/" class="url" ><span 
class="cmtt-10">http://preview.cactuscode.org/download/</span></a>. (Additional thorns specific to numerical relativity are also
located elsewhere.) Don’t use a particular thorn list for this; instead, download all the basic thorn that Cactus
offers.
</p><!--l. 180--><p class="noindent" >For reference, here is a brief overview over the commands to do this:
     </p><ol  class="enumerate1" >
<li 
  class="enumerate" id="x1-4002x1">
     <!--l. 182--><p class="noindent" ><span class="obeylines-h"><code class="verb">wget http://preview.cactuscode.org/download/GetCactus</code></span>
     </p></li>
<li 
  class="enumerate" id="x1-4004x2">
     <!--l. 183--><p class="noindent" ><span class="obeylines-h"><code class="verb">chmod a+x GetCactus</code></span>
     </p></li>
<li 
  class="enumerate" id="x1-4006x3">
     <!--l. 184--><p class="noindent" ><span class="obeylines-h"><code class="verb">./GetCactus</code></span>
     </p><!--l. 186--><p class="noindent" >This checks out Cactus itself (the <span 
class="cmti-10">flesh</span>) into a new subdirectory <span 
class="cmtt-10">Cactus</span>. When asked, choose the
     <span 
class="cmti-10">development version </span>of Cactus; use the default answer for all other questions.
     </p></li>
<li 
  class="enumerate" id="x1-4008x4">
     <!--l. 190--><p class="noindent" ><span class="obeylines-h"><code class="verb">cd Cactus</code></span>
     </p></li>
<li 
  class="enumerate" id="x1-4010x5">
     <!--l. 191--><p class="noindent" ><span class="obeylines-h"><code class="verb">make checkout</code></span>
     </p><!--l. 193--><p class="noindent" >This  checks  out  some  arrangements  with  basic  thorns  for  Cactus,  including  the  important
     CactusEinstein arrangement. Again, use the default answer for all questions, except when you are
     asked for the second time whetyer you want to quit. In this case, quit.</p></li></ol>
                                                                                       
                                                                                       
<!--l. 199--><p class="noindent" >
</p>
<h4 class="subsectionHead"><span class="titlemark">2.3   </span> <a 
 id="x1-50002.3"></a>Carpet</h4>
<!--l. 201--><p class="noindent" >Carpet <span class="cite">[<span 
class="cmbx-10">?</span>, <span 
class="cmbx-10">?</span>, <span 
class="cmbx-10">?</span>]</span> is a <span 
class="cmti-10">driver </span>for Cactus. A driver manages memory, handles parallelism, and performs I/O on
behalf of the application. Carpet supports adaptive mesh refinement (AMR) and multi-block methods. Carpet is
described at <a 
href="http://www.carpetcode.org/" class="url" ><span 
class="cmtt-10">http://www.carpetcode.org/</span></a>.
</p><!--l. 207--><p class="noindent" >To obtain Carpet, follow the instructions at <a 
href="http://www.carpetcode.org/get-carpet.html" class="url" ><span 
class="cmtt-10">http://www.carpetcode.org/get-carpet.html</span></a>. Please check out
the <span 
class="cmti-10">Development Version</span>, which is currently quite stable. (We are planning to release a new stable version
soon.)
</p><!--l. 212--><p class="noindent" >In particular, the commands to obtain the development version are:
     </p><ol  class="enumerate1" >
<li 
  class="enumerate" id="x1-5002x1">
     <!--l. 214--><p class="noindent" ><span class="obeylines-h"><code class="verb">cd Cactus</code></span>
     </p></li>
<li 
  class="enumerate" id="x1-5004x2">
     <!--l. 215--><p class="noindent" ><span class="obeylines-h"><code class="verb">git clone -o carpet git://carpetcode.dyndns.org/carpet.git</code></span>
     </p></li>
<li 
  class="enumerate" id="x1-5006x3">
     <!--l. 216--><p class="noindent" ><span class="obeylines-h"><code class="verb">cd arrangements</code></span>
     </p></li>
<li 
  class="enumerate" id="x1-5008x4">
     <!--l. 217--><p class="noindent" ><span class="obeylines-h"><code class="verb">ln -s ../carpet/Carpet* .</code></span></p></li></ol>
<!--l. 219--><p class="noindent" >(Don’t miss the dot after the <span class="obeylines-h"><code class="verb">Carpet*</code></span> in the last line.) Note that Carpet should be checked out into the main
Cactus directory, and the <span 
class="cmtt-10">arrangements</span> subdirectory needs to contain symbolic links pointing into the <span 
class="cmtt-10">carpet</span>
directory.
</p><!--l. 224--><p class="noindent" >
</p>
<h4 class="subsectionHead"><span class="titlemark">2.4   </span> <a 
 id="x1-60002.4"></a>McLachlan</h4>
<!--l. 226--><p class="noindent" >McLachlan <span class="cite">[<span 
class="cmbx-10">?</span>, <span 
class="cmbx-10">?</span>]</span> in an Einstein solver. It uses one of the BSSN formulations of the Einstein equations.
McLachlan is described at <a 
href="http://www.cct.lsu.edu/~eschnett/McLachlan/" class="url" ><span 
class="cmtt-10">http://www.cct.lsu.edu/</span><span 
class="cmtt-10">~</span><span 
class="cmtt-10">eschnett/McLachlan/</span></a>, which is where you may have
obtained this documentation.
</p><!--l. 232--><p class="noindent" >To obtain McLachlan, issue the following commands:
                                                                                       
                                                                                       
     </p><ol  class="enumerate1" >
<li 
  class="enumerate" id="x1-6002x1">
     <!--l. 234--><p class="noindent" ><span class="obeylines-h"><code class="verb">cd Cactus</code></span>
     </p></li>
<li 
  class="enumerate" id="x1-6004x2">
     <!--l. 235--><p class="noindent" ><span class="obeylines-h"><code class="verb">cd arrangements</code></span>
     </p></li>
<li 
  class="enumerate" id="x1-6006x3">
     <!--l. 236--><p class="noindent" ><span class="obeylines-h"><code class="verb">git clone git://carpetcode.dyndns.org/McLachlan.git</code></span></p></li></ol>
<!--l. 238--><p class="noindent" >Note that McLachlan needs to be checked out directly into the <span 
class="cmtt-10">arrangements</span> subdirectory.
</p><!--l. 241--><p class="noindent" >McLachlan uses the Kranc code generation package <span class="cite">[<span 
class="cmbx-10">?</span>, <span 
class="cmbx-10">?</span>, <span 
class="cmbx-10">?</span>, <span 
class="cmbx-10">?</span>]</span>. Kranc also contains some thorns that
McLachlan needs. (However, it is not necessary to run Kranc in order to use McLachlan. It is only necessary to
run Kranc if McLachlan is modified.)
</p><!--l. 247--><p class="noindent" >To obtain Kranc, issue the following commands:
     </p><ol  class="enumerate1" >
<li 
  class="enumerate" id="x1-6008x1">
     <!--l. 249--><p class="noindent" ><span class="obeylines-h"><code class="verb">cd Cactus</code></span>
     </p></li>
<li 
  class="enumerate" id="x1-6010x2">
     <!--l. 250--><p class="noindent" ><span class="obeylines-h"><code class="verb">git clone http://www.aei.mpg.de/~ianhin/kranc.git</code></span>
     </p></li>
<li 
  class="enumerate" id="x1-6012x3">
     <!--l. 251--><p class="noindent" ><span class="obeylines-h"><code class="verb">cd arrangements</code></span>
     </p></li>
<li 
  class="enumerate" id="x1-6014x4">
     <!--l. 252--><p class="noindent" ><span class="obeylines-h"><code class="verb">ln -s ../kranc/Auxiliary/Cactus/KrancNumericalTools .</code></span></p></li></ol>
<!--l. 254--><p class="noindent" >(Don’t miss the dot at the end of the last line.) Note that Kranc needs to be check out into the main Cactus
directory, and the <span 
class="cmtt-10">arrangements</span> subdirectory needs to contain symbolic links pointing into the <span 
class="cmtt-10">kranc</span>
directory.
                                                                                       
                                                                                       
</p><!--l. 259--><p class="noindent" >
</p>
<h4 class="subsectionHead"><span class="titlemark">2.5   </span> <a 
 id="x1-70002.5"></a>Other Thorns</h4>
<!--l. 261--><p class="noindent" >All other thorns, including the public Whisky thorns, can be obtained via the GetCactus script that was
downloaded above (see section <a 
href="#x1-40002.2">2.2<!--tex4ht:ref: sec:cactus --></a>):
</p><!--l. 265--><p class="noindent" >
     </p><ol  class="enumerate1" >
<li 
  class="enumerate" id="x1-7002x1">
     <!--l. 266--><p class="noindent" ><span class="obeylines-h"><code class="verb">cd Cactus</code></span>
     </p></li>
<li 
  class="enumerate" id="x1-7004x2">
     <!--l. 267--><p class="noindent" ><span class="obeylines-h"><code class="verb">cd ..</code></span>
     </p></li>
<li 
  class="enumerate" id="x1-7006x3">
     <!--l. 268--><p class="noindent" ><span class="obeylines-h"><code class="verb">./GetCactus Cactus/arrangements/McLachlan/doc/mclachlan-public.th</code></span>
     </p><!--l. 270--><p class="noindent" >Use the default answer for all questions.</p></li></ol>
<!--l. 273--><p class="noindent" >
</p>
<h4 class="subsectionHead"><span class="titlemark">2.6   </span> <a 
 id="x1-80002.6"></a>Consistency Check</h4>
<!--l. 275--><p class="noindent" >The <span 
class="cmti-10">thorn list</span> <span 
class="cmtt-10">mclachlan-public.th</span> lists the thorns that are necessary for a simple spacetime evolution. The
thorns are grouped into arrangements. All thorns listed in this file must now be present in the <span 
class="cmtt-10">arrangements</span>
subdirectory of the main Cactus directory.
</p><!--l. 283--><p class="noindent" >
</p>
<h3 class="sectionHead"><span class="titlemark">3   </span> <a 
 id="x1-90003"></a>Building McLachlan</h3>
<!--l. 285--><p class="noindent" >Building McLachlan and the other thorns requires C, C++, and Fortran 90 compilers, MPI, as well as the
BLAS, GSL, HDF5, and LAPACK libraries.
                                                                                       
                                                                                       
</p><!--l. 289--><p class="noindent" >
</p>
<h4 class="subsectionHead"><span class="titlemark">3.1   </span> <a 
 id="x1-100003.1"></a>Documentation</h4>
<!--l. 291--><p class="noindent" >It is best to begin building Cactus with building documentation:
     </p><ol  class="enumerate1" >
<li 
  class="enumerate" id="x1-10002x1">
     <!--l. 293--><p class="noindent" ><span class="obeylines-h"><code class="verb">cd Cactus</code></span>
     </p></li>
<li 
  class="enumerate" id="x1-10004x2">
     <!--l. 294--><p class="noindent" ><span class="obeylines-h"><code class="verb">make UsersGuide</code></span></p></li></ol>
<!--l. 296--><p class="noindent" >This creates the users’ guide as <span 
class="cmtt-10">doc/UsersGuide.pdf</span>.
</p><!--l. 298--><p class="noindent" >All Cactus commands are listed with
     </p><ol  class="enumerate1" >
<li 
  class="enumerate" id="x1-10006x1">
     <!--l. 300--><p class="noindent" ><span class="obeylines-h"><code class="verb">make help</code></span></p></li></ol>
<!--l. 303--><p class="noindent" >
</p>
<h4 class="subsectionHead"><span class="titlemark">3.2   </span> <a 
 id="x1-110003.2"></a>Option List</h4>
<!--l. 305--><p class="noindent" >To build a Cactus application one needs to create an <span 
class="cmti-10">options list</span>. This is a text file containing the configuration
options that tell Cactus what compilers and compiler options to use, and where MPI and the auxiliary
libraries are installed. This process is very specific to each machine and may require some trial and
error.
</p><!--l. 311--><p class="noindent" >We distribute options lists for a range of machines that we are using on the Cactus web site at
<a 
href="http://preview.cactuscode.org/download/configfiles/" class="url" ><span 
class="cmtt-10">http://preview.cactuscode.org/download/configfiles/</span></a>. Option lists are also available together with the
Simulation Factory <span class="cite">[<span 
class="cmbx-10">?</span>]</span> at <a 
href="https://svn.cct.lsu.edu/repos/numrel/simfactory/optionlists/" class="url" ><span 
class="cmtt-10">https://svn.cct.lsu.edu/repos/numrel/simfactory/optionlists/</span></a>.
</p><!--l. 318--><p class="noindent" >
</p>
<h4 class="subsectionHead"><span class="titlemark">3.3   </span> <a 
 id="x1-120003.3"></a>Building</h4>
                                                                                       
                                                                                       
<!--l. 320--><p class="noindent" >To build a Cactus application one starts with an option list and a thorn list. The text below assumes that you
have an option list called <span 
class="cmtt-10">einstein-redshift-gcc.cfg</span>.
</p><!--l. 324--><p class="noindent" >To configure an application
     </p><ol  class="enumerate1" >
<li 
  class="enumerate" id="x1-12002x1">
     <!--l. 326--><p class="noindent" ><span class="obeylines-h"><code class="verb">cd Cactus</code></span>
     </p></li>
<li 
  class="enumerate" id="x1-12004x2">
     <!--l. 327--><p class="noindent" ><span class="obeylines-h"><code class="verb">make sim-config options=redshift-gcc.cfg \</code></span><br 
class="newline" /><span class="obeylines-h"><code class="verb">THORNLIST=arrangements/McLachlan/doc/mclachlan-public.th</code></span>
     </p></li>
<li 
  class="enumerate" id="x1-12006x3">
     <!--l. 329--><p class="noindent" ><span class="obeylines-h"><code class="verb">make sim</code></span></p></li></ol>
<!--l. 331--><p class="noindent" >This is necessary only once, or when the configuration options change. This will create an application called <span 
class="cmtt-10">sim</span>;
of course, the name could also be different. Different applications, e.g. with different options or different thorn
lists, can exist side by side.
</p><!--l. 336--><p class="noindent" >To build the application:
     </p><ol  class="enumerate1" >
<li 
  class="enumerate" id="x1-12008x1">
     <!--l. 338--><p class="noindent" ><span class="obeylines-h"><code class="verb">cd Cactus</code></span>
     </p></li>
<li 
  class="enumerate" id="x1-12010x2">
     <!--l. 339--><p class="noindent" ><span class="obeylines-h"><code class="verb">make sim -j4</code></span></p></li></ol>
<!--l. 341--><p class="noindent" >The make option <span 
class="cmtt-10">-j4</span> builds 4 files at the same time. Use this option if you have several processors available; this
will speed up building the application. The executable is called <span 
class="cmtt-10">cactus</span><span 
class="cmtt-10">_sim</span> and is placed in the <span 
class="cmtt-10">exe</span>
subdirectory.
</p><!--l. 346--><p class="noindent" >
</p>
<h4 class="subsectionHead"><span class="titlemark">3.4   </span> <a 
 id="x1-130003.4"></a>Cleaning</h4>
<!--l. 348--><p class="noindent" >You can also clean the application, removing all object files but keeping the configuration options and thorn
list:
                                                                                       
                                                                                       
     </p><ol  class="enumerate1" >
<li 
  class="enumerate" id="x1-13002x1">
     <!--l. 351--><p class="noindent" ><span class="obeylines-h"><code class="verb">cd Cactus</code></span>
     </p></li>
<li 
  class="enumerate" id="x1-13004x2">
     <!--l. 352--><p class="noindent" ><span class="obeylines-h"><code class="verb">make sim-realclean</code></span></p></li></ol>
<!--l. 357--><p class="noindent" >
</p>
<h3 class="sectionHead"><span class="titlemark">4   </span> <a 
 id="x1-140004"></a>Running McLachlan</h3>
<!--l. 359--><p class="noindent" >To run the McLachlan code, one needs a <span 
class="cmti-10">parameter file</span>. Parameter files select which thorns are activated at run
time, and what values the thorns’ run-time parameters have. They typically have a <span 
class="cmtt-10">.par</span> suffix. Below, we use
the parameter file <span 
class="cmtt-10">ks-mclachlan-public.par</span>.
</p><!--l. 365--><p class="noindent" >Cactus applications are started like a regular MPI application. The exact mechanism depends on the particular
MPI implementation. On Redshift, the command is
     </p><ol  class="enumerate1" >
<li 
  class="enumerate" id="x1-14002x1">
     <!--l. 369--><p class="noindent" ><span class="obeylines-h"><code class="verb">cd Cactus</code></span>
     </p></li>
<li 
  class="enumerate" id="x1-14004x2">
     <!--l. 370--><p class="noindent" ><span class="obeylines-h"><code class="verb">mkdir simulations</code></span>
     </p></li>
<li 
  class="enumerate" id="x1-14006x3">
     <!--l. 371--><p class="noindent" ><span class="obeylines-h"><code class="verb">cd simulations</code></span>
     </p></li>
<li 
  class="enumerate" id="x1-14008x4">
     <!--l. 372--><p class="noindent" ><span class="obeylines-h"><code class="verb">env OMP_NUM_THREADS=1 mpirun -np 1 ../exe/cactus_sim \</code></span>
     <span class="obeylines-h"><code class="verb">   ../arrangements/McLachlan/doc/ks-mclachlan-public.par</code></span></p></li></ol>
<!--l. 375--><p class="noindent" >This parameter file simulates a single, stationary, spinning black hole in Kerr-Schild coordinates. It requires
about 4 GByte of RAM to run.
                                                                                       
                                                                                       
</p><!--l. 379--><p class="noindent" ><span 
class="cmti-10">Note: </span>If the options list enables OpenMP, then the Cactus application will be multi-threaded. Multi-threading
can improve performance and reduce memory consumption, especially when many (\(&gt;100\)) cores are used. However, it
is usually a bad idea to over-subscribe cores by having too many threads per node. It is usually best to choose
both the number of MPI processes per node and the number of OpenMP threads per process such that their
product equals the number of cores on a node. The way in which these numbers are chosen depend on the MPI
implementation.
</p>
 
</body></html> 

                                                                                       


